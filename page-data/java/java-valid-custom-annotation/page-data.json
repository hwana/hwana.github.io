{"componentChunkName":"component---src-templates-blog-template-js","path":"/java/java-valid-custom-annotation/","result":{"data":{"cur":{"id":"9aa8e582-2e2f-5f80-81a2-d0ed3b67e419","html":"<h2 id=\"valid\" style=\"position:relative;\"><a href=\"#valid\" aria-label=\"valid permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@Valid</h2>\n<p>자바에서 사용되는 어노테이션 중 하나로, HTTP 요청 데이터를 객체로 반환할 때 유효성 검사를 수행하는 어노테이션이다.</p>\n<h3 id=\"localvalidatorfactorybean\" style=\"position:relative;\"><a href=\"#localvalidatorfactorybean\" aria-label=\"localvalidatorfactorybean permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>LocalValidatorFactoryBean</strong></h3>\n<p>스프링에서 제공하는 Validator 인터페이스의 구현체 중 하나이다. 스프링 어플리케이션 컨텍스트 내에서 사용되며 @Valid 어노테이션을 통한 데이터 유효성 검사를 처리한다. 스프링에서는 validation 의존성만 추가해주면 자동으로 빈 등록이 되어 사용할 수 있다.</p>\n<h3 id=\"사용법\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EC%9A%A9%EB%B2%95\" aria-label=\"사용법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용법</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SignupRequestDto</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token annotation punctuation\">@NotBlank</span>\r\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">;</span>\r\n\t<span class=\"token annotation punctuation\">@NotBlank</span>\r\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/signup\"</span><span class=\"token punctuation\">)</span>\r\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Void</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">signup</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Valid</span> <span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">SignupRequestDto</span> requestDto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>유효성을 검증할 데이터를 받아올 DTO를 생성하고, 각 필드에 검증하고 싶은 유효성 어노테이션을 붙여준다. 해당 DTO에 @Valid 어노테이션을 붙이면 유효성 검증을 할 수 있다.</p>\n<h3 id=\"검증-실패\" style=\"position:relative;\"><a href=\"#%EA%B2%80%EC%A6%9D-%EC%8B%A4%ED%8C%A8\" aria-label=\"검증 실패 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>검증 실패</h3>\n<p>검증에 실패할 경우 MethodArgumentNotValidException 예외를 던지게 된다.</p>\n<h2 id=\"커스텀-어노테이션\" style=\"position:relative;\"><a href=\"#%EC%BB%A4%EC%8A%A4%ED%85%80-%EC%96%B4%EB%85%B8%ED%85%8C%EC%9D%B4%EC%85%98\" aria-label=\"커스텀 어노테이션 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>커스텀 어노테이션</h2>\n<h3 id=\"회원가입-데이터의-조건\" style=\"position:relative;\"><a href=\"#%ED%9A%8C%EC%9B%90%EA%B0%80%EC%9E%85-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%9D%98-%EC%A1%B0%EA%B1%B4\" aria-label=\"회원가입 데이터의 조건 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>회원가입 데이터의 조건</h3>\n<ul>\n<li>사용자 이름 : 최소 4자 이상, 10자 이하이며 알파벳 소문자, 숫자로 구성되어야 한다.</li>\n<li>비밀번호 : 최소 8자 이상, 15자 이하이며 알파벳 대소문자, 숫자로 구성되어야 한다.</li>\n</ul>\n<h3 id=\"signuprequestdto\" style=\"position:relative;\"><a href=\"#signuprequestdto\" aria-label=\"signuprequestdto permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SignupRequestDto</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Getter</span>\r\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span>\r\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SignupRequestDto</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token annotation punctuation\">@Username</span>\r\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">;</span>\r\n\t<span class=\"token annotation punctuation\">@Password</span>\r\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"username-password\" style=\"position:relative;\"><a href=\"#username-password\" aria-label=\"username password permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@Username, @Password</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Target</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ElementType</span><span class=\"token punctuation\">.</span>FIELD<span class=\"token punctuation\">)</span>\r\n<span class=\"token annotation punctuation\">@Retention</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RetentionPolicy</span><span class=\"token punctuation\">.</span>RUNTIME<span class=\"token punctuation\">)</span>\r\n<span class=\"token annotation punctuation\">@Constraint</span><span class=\"token punctuation\">(</span>validatedBy <span class=\"token operator\">=</span> <span class=\"token class-name\">UsernameValidator</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token annotation punctuation\">@Documented</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">Username</span> <span class=\"token punctuation\">{</span>\r\n\r\n\t<span class=\"token class-name\">String</span> <span class=\"token function\">message</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token string\">\"사용자 이름은 최소 4자 이상, 10자 이하이며 알파벳 소문자, 숫자로 구성되어야 합니다.\"</span><span class=\"token punctuation\">;</span>\r\n\r\n\t<span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">groups</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n\t<span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Payload</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">payload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token annotation punctuation\">@Documented</span>\r\n<span class=\"token annotation punctuation\">@Constraint</span><span class=\"token punctuation\">(</span>validatedBy <span class=\"token operator\">=</span> <span class=\"token class-name\">PasswordValidator</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token annotation punctuation\">@Target</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ElementType</span><span class=\"token punctuation\">.</span>FIELD<span class=\"token punctuation\">)</span>\r\n<span class=\"token annotation punctuation\">@Retention</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RetentionPolicy</span><span class=\"token punctuation\">.</span>RUNTIME<span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">Password</span> <span class=\"token punctuation\">{</span>\r\n\r\n\t\t<span class=\"token class-name\">String</span> <span class=\"token function\">message</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token string\">\"비밀번호는 최소 8자 이상, 15자 이하이며 알파벳 대, 소문자, 숫자로 구성되어야 합니다.\"</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">groups</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Payload</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">payload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>@Target(ElementType.FIELD)\n<ul>\n<li>이 어노테이션을 필드에만 적용할 수 있도록 지정</li>\n</ul>\n</li>\n<li>@Retention(RetentionPolicy.RUNTIME)\n<ul>\n<li>런타임시에도 이 어노테이션 정보를 유지할 수 있도록 저장</li>\n</ul>\n</li>\n<li>@Constraint(validatedBy = UsernameValidator.class)\n<ul>\n<li>이 어노테이션의 실제 유효성 검사를 수행하는 클래스를 지정</li>\n</ul>\n</li>\n<li>@Documented\n<ul>\n<li>이 어노테이션의 정보가 Javadoc에 포함되도록 지정</li>\n</ul>\n</li>\n<li>String message() default\n<ul>\n<li>어노테이션이 유효성 검사에 실패할 경우 사용할 디폴트 에러 메시지를 정의</li>\n</ul>\n</li>\n<li>Class&#x3C;?>[] groups() default {};\n<ul>\n<li>Bean Validation에서 그룹화를 지원하기 위한 설정, 사용하지 않으면 비어있는 배열 사용</li>\n</ul>\n</li>\n<li>Class&#x3C;? extends Payload>[] payload() default {};\n<ul>\n<li>추가적인 정보를 전달할 때 사용, 사용하지 않으면 비어있는 배열 사용</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"usernamevalidator-passwordvalidator\" style=\"position:relative;\"><a href=\"#usernamevalidator-passwordvalidator\" aria-label=\"usernamevalidator passwordvalidator permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UsernameValidator, PasswordValidator</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UsernameValidator</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ConstraintValidator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Username</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> MIN_SIZE <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> MAX_SIZE <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> regexUsername <span class=\"token operator\">=</span> <span class=\"token string\">\"^[a-z0-9]+[a-z0-9]{\"</span> <span class=\"token operator\">+</span> MIN_SIZE <span class=\"token operator\">+</span> <span class=\"token string\">\",\"</span> <span class=\"token operator\">+</span> MAX_SIZE <span class=\"token operator\">+</span> <span class=\"token string\">\"}$\"</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token annotation punctuation\">@Override</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isValid</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ConstraintValidatorContext</span> context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">boolean</span> isValidUsername <span class=\"token operator\">=</span> username<span class=\"token punctuation\">.</span><span class=\"token function\">matches</span><span class=\"token punctuation\">(</span>regexUsername<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isValidUsername<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            context<span class=\"token punctuation\">.</span><span class=\"token function\">disableDefaultConstraintViolation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            context<span class=\"token punctuation\">.</span><span class=\"token function\">buildConstraintViolationWithTemplate</span><span class=\"token punctuation\">(</span>\r\n                    <span class=\"token class-name\">MessageFormat</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{0}자 이상의 {1}자 이하의 숫자, 영문자를 포함한 이름을 입력해주세요.\"</span><span class=\"token punctuation\">,</span>\r\n                            MIN_SIZE<span class=\"token punctuation\">,</span>\r\n                            MAX_SIZE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addConstraintViolation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        <span class=\"token keyword\">return</span> isValidUsername<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token annotation punctuation\">@Component</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PasswordValidator</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ConstraintValidator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Password</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> MIN_SIZE <span class=\"token operator\">=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> MAX_SIZE <span class=\"token operator\">=</span> <span class=\"token number\">15</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> regexPassword <span class=\"token operator\">=</span> <span class=\"token string\">\"^(?=.*[A-Za-z])(?=.*[0-9])[A-Za-z0-9]{\"</span> <span class=\"token operator\">+</span> MIN_SIZE <span class=\"token operator\">+</span> <span class=\"token string\">\",\"</span> <span class=\"token operator\">+</span> MAX_SIZE <span class=\"token operator\">+</span> <span class=\"token string\">\"}$\"</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token annotation punctuation\">@Override</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isValid</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> password<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ConstraintValidatorContext</span> context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">boolean</span> isValidPassword <span class=\"token operator\">=</span> password<span class=\"token punctuation\">.</span><span class=\"token function\">matches</span><span class=\"token punctuation\">(</span>regexPassword<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isValidPassword<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            context<span class=\"token punctuation\">.</span><span class=\"token function\">disableDefaultConstraintViolation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            context<span class=\"token punctuation\">.</span><span class=\"token function\">buildConstraintViolationWithTemplate</span><span class=\"token punctuation\">(</span>\r\n                            <span class=\"token class-name\">MessageFormat</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{0}자 이상의 {1}자 이하의 숫자, 대,소문자를 포함한 비밀번호를 입력해주세요\"</span><span class=\"token punctuation\">,</span> MIN_SIZE<span class=\"token punctuation\">,</span> MAX_SIZE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">addConstraintViolation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        <span class=\"token keyword\">return</span> isValidPassword<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>isValid() : 유효성 검사를 진행하는 로직 작성</li>\n<li>context.disableDefaultConstraintViolation() : 기본 에러 메시지를 사용하지 않도록 설정</li>\n<li>context.buildConstraintViolationWithTemplate() : 사용자 정의 에러 메시지를 추가</li>\n<li>addConstraintViolation() : 에러가 발생하게 되면 에러 정보를 ConstraintValidatorContext에 추가하여 클라이언트에게 전달한다. 전달된 정보는 에러 메시지를 생성하는데 사용된다.</li>\n</ul>\n<p><a href=\"https://mangkyu.tistory.com/206\">참고1</a>\r\n<a href=\"https://velog.io/@livenow/Java-%EC%BB%A4%EC%8A%A4%ED%85%80-%EC%95%A0%EB%85%B8%ED%85%8C%EC%9D%B4%EC%85%98%EC%9C%BC%EB%A1%9C-Password%EA%B7%9C%EC%B9%99-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0\">참고2</a></p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#valid\">@Valid</a></p>\n<ul>\n<li><a href=\"#localvalidatorfactorybean\"><strong>LocalValidatorFactoryBean</strong></a></li>\n<li><a href=\"#%EC%82%AC%EC%9A%A9%EB%B2%95\">사용법</a></li>\n<li><a href=\"#%EA%B2%80%EC%A6%9D-%EC%8B%A4%ED%8C%A8\">검증 실패</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%BB%A4%EC%8A%A4%ED%85%80-%EC%96%B4%EB%85%B8%ED%85%8C%EC%9D%B4%EC%85%98\">커스텀 어노테이션</a></p>\n<ul>\n<li><a href=\"#%ED%9A%8C%EC%9B%90%EA%B0%80%EC%9E%85-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%9D%98-%EC%A1%B0%EA%B1%B4\">회원가입 데이터의 조건</a></li>\n<li><a href=\"#signuprequestdto\">SignupRequestDto</a></li>\n<li><a href=\"#username-password\">@Username, @Password</a></li>\n<li><a href=\"#usernamevalidator-passwordvalidator\">UsernameValidator, PasswordValidator</a></li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"@Valid 자바에서 사용되는 어노테이션 중 하나로, HTTP 요청 데이터를 객체로 반환할 때 유효성 검사를 수행하는 어노테이션이다. LocalValidatorFactoryBean 스프링에서 제공하는 Validator 인터페이스의 구현체 중 하나이다. 스프링 어플리케이션 컨텍스트 내에서 사용되며 @Valid 어노테이션을 통한 데이터 유효성 검사를 처리한다. 스프링에서는 validation 의존성만 추가해주면 자동으로 빈 등록이 되어 사용할 수 있다. 사용법 유효성을 검증할 데이터를 받아올 DTO를 생성하고, 각 필드에 검증하고 싶은 유효성 어노테이션을 붙여준다. 해당 DTO에 @Valid 어노테이션을 붙이면 유효성 검증을 할 수 있다. 검증 실패 검증에 실패할 경우 MethodArgumentNotValidException 예외를 던지게 된다. 커스텀 어노테이션 회원가입 데이터의 조건 사용자 이름 : 최소 4자 이상, 10자 이하이며 알파벳 소문자, 숫자로 구성되어야 한다. 비밀번호…","frontmatter":{"date":"November 13, 2023","title":"커스텀 어노테이션으로 회원가입 유효성 검사하기","categories":"자바","author":"화나","emoji":"🐌"},"fields":{"slug":"/java/java-valid-custom-annotation/"}},"next":{"id":"5916bbd8-7edf-5e79-bc5e-16082ba80919","html":"<h1 id=\"websecurityconfig\" style=\"position:relative;\"><a href=\"#websecurityconfig\" aria-label=\"websecurityconfig permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WebSecurityConfig</h1>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\r\n<span class=\"token annotation punctuation\">@EnableWebSecurity</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WebSecurityConfig</span> <span class=\"token punctuation\">{</span>\r\n\r\n\t<span class=\"token annotation punctuation\">@Bean</span>\r\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">SecurityFilterChain</span> <span class=\"token function\">securityFilterChain</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token comment\">// CSRF 설정</span>\r\n\t\thttp<span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>csrf<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> csrf<span class=\"token punctuation\">.</span><span class=\"token function\">disable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n\t\thttp<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeHttpRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>authorize<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> authorize\r\n            <span class=\"token punctuation\">.</span><span class=\"token function\">requestMatchers</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PathRequest</span><span class=\"token punctuation\">.</span><span class=\"token function\">toStaticResources</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">atCommonLocations</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n                <span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n\t\thttp<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Customizer</span><span class=\"token punctuation\">.</span><span class=\"token function\">withDefaults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n\t\t<span class=\"token keyword\">return</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \r\n\t\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>CSRF(Cross Site Request Forgery)란?</p>\n<ul>\n<li>웹 취약점 공격 방법중 하나로 사용자가 자신의 의지와 무관하게 공격자가 의도한 행위를 특정 웹사이트에 요청하게 하는 공격</li>\n</ul>\n</li>\n<li>\n<p>Spring Security에서는 CSRF 예방기능을 제공하는데 DISABLE 하는 이유</p>\n<p><a href=\"https://docs.spring.io/spring-security/reference/features/exploits/csrf.html#csrf-considerations\">Cross Site Request Forgery (CSRF) :: Spring Security</a></p>\n<p>공식 페이지에 나와있듯, CSRF 설정은 브라우저에서 처리할 수 있는 모든 요청에 대해서 사용하는 것이 좋다. CSRF를 사용하지 않도록 사용하는 경우는 브라우저 이외의 클라이언트에서만 사용하는 서비스(REST API)를 생성할 경우이다. REST API는 서버에 인증정보를 보관하지 않기 때문에 CSRF 공격에 크게 영향을 받지 않는다.</p>\n</li>\n<li>\n<p>authorizeRequests() : 특정 경로에 대한 접근 권한을 지정하는 메소드</p>\n</li>\n<li>\n<p>requestMatchers(PathRequest.toStaticResources().atCommonLocations()).permitAll() : 정적 리소스에 대한 접근은 모두에게 허용한다.</p>\n</li>\n<li>\n<p>anyRequest().authenticated() : 나머지 모든 요청은 인증된 사용자에게 허용된다.</p>\n</li>\n<li>\n<p>http.build() : http 객체를 빌드하여 SecurityFilterChain빈을 반환한다.</p>\n</li>\n</ul>\n<h1 id=\"usernamepasswordauthenticationfilter\" style=\"position:relative;\"><a href=\"#usernamepasswordauthenticationfilter\" aria-label=\"usernamepasswordauthenticationfilter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UsernamePasswordAuthenticationFilter</h1>\n<ul>\n<li>스프링 시큐리티에서 제공하는 사용자 인증을 처리하는데 사용되는 필터</li>\n<li>사용자가 제공한 사용자 이름과 비밀번호를 기반으로 인증을 수행한다.</li>\n<li>주로 웹 기반의 폼 로그인에서 사용하는 필터이다.</li>\n</ul>\n<h2 id=\"동작의-흐름\" style=\"position:relative;\"><a href=\"#%EB%8F%99%EC%9E%91%EC%9D%98-%ED%9D%90%EB%A6%84\" aria-label=\"동작의 흐름 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>동작의 흐름</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 91.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFdklEQVQ4yzWQCVCTdxDFF0SkylER1HrgSFVQq0VBreJRO3aKM6IiEAJJOAzxywUKihwWVEC5Kh4cAWJIvhwcaaIIKCBKkTMEQgKBEAmikqoYrHe9nX8nVHfmN2/f7O7MzoMV7ivd1ixfvXrF0h88md7uO47vcN/lu3bV2uDQsKk0/53TA4gkS7t539sAgN3+UvV+YolKRChUcAPy2i4Si1UcIlddSBHe5kZKH7pFysYBgsIjp6JDKwHFOME75uIj75mLL79lLnVHR5fBql1kK//dvtZTXNdZubm6erD5XbeCzjciwrkGRDj7P4FnriJSUQfC5CYfrGoCIGq9izVKc3dA17ztHmFuK1uISzYhsZcjKvWw1zG8HLyIjCkz7B2nUVIlUHe5duYl9ev51Pg/tgfTEwlXNK/nc67qFufLuxd69CAQpnIARjIphD7Sd68a9jg9vunnPFG/x3mica/zoxt7nd8YqQsrUDbAdIBpGEdhFyQybvYTPvjJr0j7y28pMoJvQd/WAMnjDcGy59tC//xnJfXqvwCqgsSQ3oPe+hu09ap6qpeyNsJT0XRgg/IvbL1h9KBnNkC7JWcMAa9lbHNUxQCKEPQimliLqIJeFHFR8QUlYl5+WB5VbQQIuFBrvRv+r3uJPlv00d5khIbtIgEAAUAtnm9pnoWQaD/GpnGIMencAFbyhZDDWXzf/GrVpnOyjs250rZtqWVKl2yZEiDw1y02sQCTR5/YrrEf2K6Vg6RFngghIG10d/BYs8bGydHpG1trOxcAmPWF2QAw47iwHdLL2uGkqAWSREo4Ud4FwDyWabXDP+LbbTuJjrD1mB0so86CnUdsfPwp9ht8Am3tbWdYz12+zuoYQhY/U2Kmb/THbLdTk6Zv9wtdEnTotG1yF7JiC5TWLNmoFSGv1QL84grNz1kDwNx5AC6udrB69+kqCJcagSLQTUZB57ZCYHH31705AOCwaI7TFh5CQChsgxCJAcLlDyG4SAlAPXvNnVp5359R83RXSIkqIJQ/QKBW3NsTLhkJoIpv+8wGsKQVNm+giAwJZFx/kITrD4XwtDGB+Z2JJP5gbPDF/lhiiTomrOxe3L5TV/bB76K2TCpPifbzlJ+ovO7PVJ7yc3hJ56eI4nZE5Ws0EoTgZHlnBoarEIb3PqOLNC8xXPWSLu57gQl7zWr2z6ncjvdBWTVFkCxqp7El/V0sibaJJe5vZuC9zSzJQFNUpb6TVTnCfYUQpMq1h+MbX/7NEGt1mKBXj+EavVkPCFR6Gk+px3D1UELTm1Hy+aYsOCFuSWDg3fcZIvUAXdAzRBd0DzFE6kGGSH2XUaa7ZEII0mXqhKN1Tx6xxP23mUKNgYGrDQyh2sDAew10fo+BKdQMx19/PkY+25gNKXJd7JGGF3fCSzr7KAW3tOHFHVpyXlNfdNWDkcPXX0s1CEFalS45vvn9M6xs8B5NqDZGCjXGSH6PMVKgMmLlQ0amdHgsoeWjiVLYdh7S5ZozcfUTH0Lzrk+E5NY8JZ2peRqUIX0SJb/zLq7x5c2PCEGGXMVOvPpAdViquxVT1tcaU97fGluubY2ZpN+sLUl14wpyTm0S5GWmOXFOJrlU8PAFUoF4ErlEuqA0+/TC4wejnKvNGV4ZTmHJx96EXLj5KKxYYQotajeFlShMocWdJnJBs4lc2DrOqnr4IqxIUQA4pwCE53Kh9nI91FXfgGvVN6ChrhVkvFLInwlwahxBamV3XHTlkJFdptVFV+r1URW6SQ7JDHqzZ0v6h6Ir9aPBOdcyIY8vs8gRNlhk4/UWOV8w9xncKouUW28tU+8iSCtvP8kQqh5j/C4DVqoY/Qod7xml492jNG7bCF2oekDKrcv6D+wo3nj/znU1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/662295215e47b909a64ae292068f09b2/37523/1.png\"\n        srcset=\"/static/662295215e47b909a64ae292068f09b2/e9ff0/1.png 180w,\n/static/662295215e47b909a64ae292068f09b2/f21e7/1.png 360w,\n/static/662295215e47b909a64ae292068f09b2/37523/1.png 720w,\n/static/662295215e47b909a64ae292068f09b2/302a4/1.png 1080w,\n/static/662295215e47b909a64ae292068f09b2/07a9c/1.png 1440w,\n/static/662295215e47b909a64ae292068f09b2/2b608/1.png 1540w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ol>\n<li>사용자가 로그인 폼에 이름과 비밀번호를 입력한 뒤 로그인 요청을 전송하면 UsernamePasswordAuthenticationFilter 가 요청을 가로채서 사용자가 입력한 정보로 UsernamePasswordAuthenticationToken 을 생성한다.</li>\n<li>생성한 토큰을 AuthenticationManager 에게 전달한다. AuthenticationManager 는 실제로 사용자를 인증하는 역할을 수행한다.\n<ul>\n<li>인증에 성공할 경우\n<ul>\n<li>Authentication 객체를 생성하고 이 객체를 SecurityContextHolder에 저장한다.</li>\n<li>AuthenticationSuccessHandler 실행되어 로그인 이후 특정 동작을 수행한다.</li>\n</ul>\n</li>\n<li>인증에 실패할 경우\n<ul>\n<li>AuthenticationFailureHandler가 실행되어 에러페이지로 리디렉션하거나 특정 동작을 구행한다.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"securitycontextholder\" style=\"position:relative;\"><a href=\"#securitycontextholder\" aria-label=\"securitycontextholder permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SecurityContextHolder</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAACBUlEQVQozzWLzVMSYQCH97/rkpPJ1HTq0LRYl05+NFOHGg9M5ojLgpCKrisbIJSyLLi7fCyLieBCmqGpI2VjzsSkjV2AgPf9NTDT4bk88zyM493eq+GNJlitTVitTVm1hZtOEzZfBXfndzHgNHHHV8bQ7A5s3h3c4vIY5DZxw6Fi0PsRdr3Te8GqbTxOdcBMrVVEoXgN47RFtOMG1Y4bUCo/MBs1wYXS8EQycAY24JR0uMIZTAdUeKImIpvHkMsX0E+a6D3Z0yaWSn/AvH5f8ZvVS5xf/SW1eoPW6g2cXwOFz2dQzF1krCPEDQtaoYpU8RCyUYZePETtVxtnV13U6s0+3y9byFV/g3FH8otP/BU80ECGdUIfql1q1yllk01qc2/Tgek8tc1adNBdokOeMr3t2qL3lg77jV0jlNUIfZSi9L7SoZPqT8pMSWn/S6GA0PZ5R0hXu+HCVxLIHZHQ1jcysbpPFuLbxBMxyFxsi3gjGeIKZ8lE9ICIxhERs1+IlD8hYvaALKRPiE+/6DKTwZz4wpfGulrCclCBEExgxhvAavwDuOg+VqJpzC3HIAST8EtxvFlJwCEW4V+JYV5cg/BWwZIkw+2PgY/VwCyuGY5nHvnTyIxcGueT1iinWGN80hqZka1xbt0a4eLWGJ+wxlz/UaynvNxv+vQcn9gZ5TfKz6U94x/EbaUduIWe/AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/28f0f6e49649bc90a0d215b286da1559/37523/2.png\"\n        srcset=\"/static/28f0f6e49649bc90a0d215b286da1559/e9ff0/2.png 180w,\n/static/28f0f6e49649bc90a0d215b286da1559/f21e7/2.png 360w,\n/static/28f0f6e49649bc90a0d215b286da1559/37523/2.png 720w,\n/static/28f0f6e49649bc90a0d215b286da1559/587b0/2.png 970w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>\n<p>현재 사용자의 인증 정보를 저장하고 언제든지 접근할 수 있도록 하는 클래스이며 SecurityContext를 관리한다.</p>\n</li>\n<li>\n<p>SecurityContext에는 Authentication 객체와 관련된 보안 정보가 저장된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">SecurityContext</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token class-name\">Authentication</span> <span class=\"token function\">getAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token keyword\">void</span> <span class=\"token function\">setAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>Authentication는 현재 사용자의 인증정보를 나타내는 인터페이스이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Authentication</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Principal</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token class-name\">Object</span> <span class=\"token function\">getCredentials</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token class-name\">Object</span> <span class=\"token function\">getDetails</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token class-name\">Object</span> <span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token keyword\">boolean</span> <span class=\"token function\">isAuthenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token keyword\">void</span> <span class=\"token function\">setAuthenticated</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">boolean</span> isAuthenticated<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<h2 id=\"userdetailsservice\" style=\"position:relative;\"><a href=\"#userdetailsservice\" aria-label=\"userdetailsservice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UserDetailsService</h2>\n<p>사용자의 정보를 DB에서 가져와 검증하고 UserDetails 객체로 반환한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomUserDetailsService</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserDetailsService</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token annotation punctuation\">@Autowired</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserRepository</span> userRepository<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token annotation punctuation\">@Override</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserDetails</span> <span class=\"token function\">loadUserByUsername</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">UsernameNotFoundException</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByUsername</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span>\r\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UsernameNotFoundException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"User not found with username: \"</span> <span class=\"token operator\">+</span> username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CustomUserDetails</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"userdetails\" style=\"position:relative;\"><a href=\"#userdetails\" aria-label=\"userdetails permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UserDetails</h2>\n<p>사용자의 정보를 표현하는 인터페이스,  UsernamePasswordAuthenticationToken 타입의 Authentication를 만들 때 사용되며 해당 인증객체는 SecurityContextHolder에 세팅된다.</p>\n<h1 id=\"기본-로그인\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EB%B3%B8-%EB%A1%9C%EA%B7%B8%EC%9D%B8\" aria-label=\"기본 로그인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기본 로그인</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSklEQVQY012Qy0rDQBiF81Q+jA/hY7jvoqW5CBWsUMWF4s6VYLEo1mBMFRN00aY2t5p0Lv/8k5mOSBdWv92Bc+DjWGYLrTUA/Oa1kVwDlUCkBLVdK8slpdQKivkwiUtGUAgOnBDCOWeMAwClpFpVSivZIAgQQjRNY4xhlI5uR1EUW0eTu5P74eV4FIwffd/P8zzLsvHDOMsyAEg+05pQxvgknDDOKaUAMJvNBoPTIHi2XhbJTRgwFPVXRQhZrVaIKARKZErJjb3WWjXIOUdEYwwHiKK4KApLKbWR2ZBlaZqmZbkkdY7I96/ivYu369fEGJmXpe/7YRgmyZyzHwvr32ECoKrr6XQmBMhG756/7ww+zp4WxphGaSklAGit18Yg4p+xUqrf77darXa7bdu24zjHPW9w6PUOvG7Xtm3bdV3P8xzHcV230+l8A4HYeMdBL7zqAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3\"\n        title=\"3\"\n        src=\"/static/c296bd303b5bc5bb85f1e40013bae820/37523/3.png\"\n        srcset=\"/static/c296bd303b5bc5bb85f1e40013bae820/e9ff0/3.png 180w,\n/static/c296bd303b5bc5bb85f1e40013bae820/f21e7/3.png 360w,\n/static/c296bd303b5bc5bb85f1e40013bae820/37523/3.png 720w,\n/static/c296bd303b5bc5bb85f1e40013bae820/302a4/3.png 1080w,\n/static/c296bd303b5bc5bb85f1e40013bae820/07a9c/3.png 1440w,\n/static/c296bd303b5bc5bb85f1e40013bae820/29114/3.png 1920w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ol>\n<li>로그인 시도할 username, password 정보를 POST HTTP body로 전달한다. Authentication Manager는 UserDetailsService에게 username을 전달하고 회원 상세정보를 요청한다.</li>\n<li>UserDetailsService는 전달받은 username으로 DB에서 회원 정보를 조회한다.\n<ul>\n<li>성공할 경우 UserDetails 객체를 생성하여 반환한다.</li>\n<li>실패할 경우 에러를 발생시킨다.</li>\n</ul>\n</li>\n<li>Authentication Manager는 전달받은 UserDetails 객체로 인증을 시도하여 성공하면 세션에 로그인 정보를 저장한다.</li>\n</ol>\n<blockquote>\n<p>UserDetailsService와 UserDetails를 직접 구현하면 Spring Security에서 제공하는 디폴트 로그인 기능을 사용하지 않겠다는 뜻이 되어서 기본 비밀번호를 제공하지 않는다.</p>\n</blockquote>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EB%8F%99%EC%9E%91%EC%9D%98-%ED%9D%90%EB%A6%84\">동작의 흐름</a></p>\n<ul>\n<li><a href=\"#securitycontextholder\">SecurityContextHolder</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#userdetailsservice\">UserDetailsService</a></p>\n</li>\n<li>\n<p><a href=\"#userdetails\">UserDetails</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"November 10, 2023","title":"Spring Security","categories":"보안","author":"화나","emoji":"🔐"},"fields":{"slug":"/security/spring-security/"}},"prev":{"id":"d05219b6-60e7-5f52-b472-27d11993726d","html":"<p>Filter에서 발생하는 Exception 처리하기</p>","frontmatter":{"date":"November 14, 2023","title":"Filter에서 발생하는 Exception 처리하기","categories":"보안","author":"화나","emoji":"🔐"},"fields":{"slug":"/security/filter-exception-handler/"}},"site":{"siteMetadata":{"siteUrl":"https://www.hwana.com","comments":{"utterances":{"repo":"hwana/hwana.github.io"}}}}},"pageContext":{"slug":"/java/java-valid-custom-annotation/","nextSlug":"/security/spring-security/","prevSlug":"/security/filter-exception-handler/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}