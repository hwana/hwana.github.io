{"componentChunkName":"component---src-templates-blog-template-js","path":"/spring/filter-interceptor/","result":{"data":{"cur":{"id":"78fcc5ce-17d7-5308-91af-8c5f31554edc","html":"<p>필터와 인터셉터 모두 웹 애플리케이션에서 요청을 가로채어 중간에서 작업을 처리하는 구성요소이다.</p>\n<h2 id=\"공통점\" style=\"position:relative;\"><a href=\"#%EA%B3%B5%ED%86%B5%EC%A0%90\" aria-label=\"공통점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>공통점</h2>\n<ol>\n<li>필터 체인, 인터셉터 스택을 통해서 요청과 응답에 대한 여러 작업을 순차적으로 처리할 수 있다.</li>\n<li>두 기능 모두 웹 애플리케이션의 핵심 로직과 분리되어 작업을 수행하고, 작업을 공통적으로 처리하여 코드의 중복을 줄일 수 있는 장점이 있다.</li>\n</ol>\n<p>이 둘은 어떻게 동작하며, 차이점은 무엇이 있을까? 각 기능에 대해서 알아보자!</p>\n<h1 id=\"filter\" style=\"position:relative;\"><a href=\"#filter\" aria-label=\"filter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Filter</h1>\n<p>필터는 J2EE 표준 스펙 기능으로 DispatcherServlet에 요청이 전달되기 전/후에 부가 작업을 처리할 수 있는 기능을 제공한다.</p>\n<p>스프링이 아닌 톰캣과 같은 웹 컨테이너에 의해 관리가 되지만, 스프링 빈으로 등록은 가능하다.</p>\n<details>\r\n<summary>필터는 여러개를 체인 형식으로 묶어서 처리할 수도 있다. </summary>\r\n<div markdown=\"1\">\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 361px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 135%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFBUlEQVRIx5WVW1BVdRTG7aHygqB5G8X7TKVjD03TWy/10DipNV4yxxT1KCIaomXqTOGUgDWoXZxQHxzJDOV+EQ5wuKgIahgpigamEmLiBQU5e59z9n3/mn1Rj2IPnZlvr/9/fWt/c/b69vrvfqYJpnUBJEmj1y/hF2QXzjoY0AiIKqKoIojKo/wjiDKG4Wj0Mx1FDODk3lOULDhM2Yp8yjy5lHnyKFmazf75uzm8MIP8xQcpiMmk3JOPd5nDe5fkUL66CH9vKFwQVAxqUn0ceXsfpbMOUPLez3hn/ELeu3vY8noiSW8ksuG1WHa9lUrFrEybL51xgNLpGZTOzaSnO/ikoI7B6awGfF94OZpaSXWyj6qtFTaqU3wcSjhIWdIRalIc7iGqvi6ndsdxggHFEbQulqiu6yi6Zj96QJGQTd1eW//cig1nG+nq7bH3kq4iGS501c491LEFBf8DSr0+fN4Kqn1V1B8/QW3NMXxlPs6fbbJKCYkChqri3tkX7s8W1FSVjo4bXOu4SUt7Jzfv+/m7s4uLVztov92NBFxqu8FdUcZqfUAPg+HGYAhd0xxB63GDkgz//AnnvJhNFXDeB82V0FQOF3w0Z6Sg1GfZe62x1MEfVixBP1eBEhCQFMURNDSV3pCKtG8NrByMuW48ZkI0JEbjjxtN8cxhVM8ZRe28kSifWPmxsHasExNGw8ZXMbpvI+uGK6hr9AQVgntiwfMirBkF8cNh9XDUuGG0LxpKy8JhnJkTRWfMUFgzAtPmR8CqobB+Ivr9znBBnV4xSO+ZMoTi7xHKdiN40xG8P9nQqvZy8ce1+It2ECjf4+bTbfhLdiEfzcAIBZAV9XEPAwHReh3RrH0YNNtjONt2ix7XTP0pWGndNJFl2RXUNNslhHvQeQXutMFtC9ccdHfQWl2Aeb0ZutrdfFjN3XZ0VUF+aIquqfglDeXXjbA2GnPzNMyNU2DzVPyJr1A6fxKVCyZR+/FktM+nwKYpNm9umoq54WVIehPdMkV72pT0pRDTz2n0ysGwMhLVE8GVDwdwcV4EDe8P4P7iQRAXCbEOz4qBttP6vZt9TXlwIg/h0BaE3G0IuakIOamIuSnoRd/Sut2DcCjJ4XJSbM6q8WdvRS79ASMo9DXFcE0IhzVsVr6xvYtu14CnawzbFJBlKcyUkAQ3W+BcGTRXw4UqF5Vw+RiXs3Zi/l4Ml446uXD+0jF0KfTYFEPTnEnZnwBxQzDXT8RIHAfrxyPER+ObPZLq2SM5OX8USsI4WDcOM3GcO1FjYNNU9O5bfU0J7fbAkucg/iWIi4JVUcjLI2meO5CmeZHUzxrInUURED/E5YdAbIT9Zuj3njEpD2pzEDK/dJuejJCdjJizFaNoG1d2ehAtLjcFIXurzVk1/qyvkEu+c0xRw00RxWc2XHGnoeHqLdsU43+Zcvuq3WBa66G1DrOlDi7XQftvtOSlozf5oO00WHkLrVY8AX+dQpefZUpGot0/89PJGOsmwGcT6Vg+lsaFY2jzjOX8ojE0x0SjJU6wTxjLPNM6wjZP+69JWRY2KZEQH8X1jwZQ+M7zNH7Qn5rpL1A3sz9mbKQzLZYxKwZBwpgnJ0XXNef4OlmImJOMWLgdsSANoSANqSgNo2Q7anEauhWPpCEWptm8FYX8b1DK0zGlsOPLMAwEQSCog2h9MwDRdNZW9JsgGCCYDux8WJ31RQ5JEqqq8C+oGBXxR1iTogAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사진\"\n        title=\"사진\"\n        src=\"/static/3944e64c219dcd12913fce59c42db2e2/39d76/chain.png\"\n        srcset=\"/static/3944e64c219dcd12913fce59c42db2e2/e9ff0/chain.png 180w,\n/static/3944e64c219dcd12913fce59c42db2e2/f21e7/chain.png 360w,\n/static/3944e64c219dcd12913fce59c42db2e2/39d76/chain.png 361w\"\n        sizes=\"(max-width: 361px) 100vw, 361px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</div>\r\n</details>\n<h2 id=\"메소드\" style=\"position:relative;\"><a href=\"#%EB%A9%94%EC%86%8C%EB%93%9C\" aria-label=\"메소드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>메소드</h2>\n<p>Filter 인터페이스는 3가지 메소드를 가지고 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Filter</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">void</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FilterConfig</span> filterConfig<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">FilterChain</span> chain<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">void</span> <span class=\"token function\">destroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol>\n<li>init 메소드\n<ul>\n<li>필터 객체를 초기화하고 서비스에 추가하기 위한 메소드</li>\n<li>웹 컨테이너가 init 메소드를 호출하여 필터 객체를 초기화 하면 이후 요청들은 doFilter를 통해서 처리된다.</li>\n</ul>\n</li>\n<li>doFilter 메소드\n<ul>\n<li>이 메소드에서 실제 필터링 작업을 수행하며, 요청/응답 데이터를 수정할 수 있다.</li>\n<li>FilterChain 객체를 사용하여 다음 필터로 제어를 전달하고, 모든 작업이 다 끝나면 요청을 처리할 컨트롤러로 전달한다.</li>\n</ul>\n</li>\n<li>destroy 메소드\n<ul>\n<li>필터가 소멸될 때 호출되는 메소드</li>\n<li>필터 자원을 정리하고 메모리 누수를 방지하기 위해서 사용한다.</li>\n</ul>\n</li>\n</ol>\n<h1 id=\"interceptor\" style=\"position:relative;\"><a href=\"#interceptor\" aria-label=\"interceptor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>InterCeptor</h1>\n<p>인터셉터는 스프링이 제공하는 기술이기 때문에 스프링 컨텍스트에서 동작한다.</p>\n<h2 id=\"메소드-1\" style=\"position:relative;\"><a href=\"#%EB%A9%94%EC%86%8C%EB%93%9C-1\" aria-label=\"메소드 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>메소드</h2>\n<p>HandlerInterceptor 인터페이스는 3가지 메소드를 가지고 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">HandlerInterceptor</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">default</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">preHandle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> handler<span class=\"token punctuation\">)</span>\r\n        <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\r\n        \r\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">default</span> <span class=\"token keyword\">void</span> <span class=\"token function\">postHandle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> handler<span class=\"token punctuation\">,</span>\r\n        <span class=\"token annotation punctuation\">@Nullable</span> <span class=\"token class-name\">ModelAndView</span> modelAndView<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">default</span> <span class=\"token keyword\">void</span> <span class=\"token function\">afterCompletion</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> handler<span class=\"token punctuation\">,</span>\r\n        <span class=\"token annotation punctuation\">@Nullable</span> <span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol>\n<li>preHandler 메소드\n<ul>\n<li>컨트롤러의 메소드가 실행되기 전에 호출 된다.</li>\n<li>요청을 가로채서 수정할 수 있는 메소드, false를 반환하면 요청을 계속 처리하지 않고 중단된다.</li>\n</ul>\n</li>\n<li>postHandler 메소드\n<ul>\n<li>컨트롤러의 메소드가 실행된 후 뷰가 렌더링 되기 전에 호출되는 메소드</li>\n<li>컨트롤러 이후에 처리해야하는 후처리 작업에 주로 사용된다.</li>\n</ul>\n</li>\n<li>afterCompletion 메소드\n<ul>\n<li>뷰가 렌더링 된 후에 호출된다.</li>\n<li>예외 처리 및 마무리 작업을 할 수 있다.</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"차이점\" style=\"position:relative;\"><a href=\"#%EC%B0%A8%EC%9D%B4%EC%A0%90\" aria-label=\"차이점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>차이점</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABfElEQVQoz12ST0/bQBDF/WHplROHHPoFkDgUIXFCrdQDINQTlYqAFIoIhABKSPlnQghOsqkhTnBCSGK8u/5Vuy4F8bSjt7N6mhm9WSdJEkyQaKLREAMpJbGMUUohlUxZSnzfp9PuEoY9hsMhSiurM5o4TvWOLQYEjxGrhRrtx8jmieYVqYROGLCc/UK1USHRCe9hmjq9fp+jQp5cyWXpKOD4osHFZZls5RublSXW3K+ci2PKxTNO3RKZzxPsnfzCb90xGPcpiRx5bx0R1lBK40TRMw+dNm4jYDEvuL0bcN9tMr/9kblshpn1SXLVHyBB3HtkFj6wX95h8DDisL7F7PYUs5tTLBc/MX4e4zSFsBP+vvnDYsFn6+AUz7umKHY5bPzkoL5BvXPNTaVG1btieiXD2s533HOXQdTnpLVnNSK8TSf8ZyGtcMRKoYnojgBtz1sPtdbW+G4vsIt46+3L3XqYbjhBKs1TFFtOc/k/zPZMmKIGhl/eXjXS/pa/zfwF95qJXN4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사진\"\n        title=\"사진\"\n        src=\"/static/6b762167bf011fb26ab9487104c7610d/37523/image.png\"\n        srcset=\"/static/6b762167bf011fb26ab9487104c7610d/e9ff0/image.png 180w,\n/static/6b762167bf011fb26ab9487104c7610d/f21e7/image.png 360w,\n/static/6b762167bf011fb26ab9487104c7610d/37523/image.png 720w,\n/static/6b762167bf011fb26ab9487104c7610d/3c051/image.png 760w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><a href=\"https://www.baeldung.com/spring-mvc-handlerinterceptor-vs-filter\">이미지 출처</a></p>\n<p>필터는 DispatcherServlet에 도달하기 전 요청을 가로채며 인증, 로깅 및 감사, 이미지 및 데이터 압축, Spring MVC에서 분리하고 싶은 모든 기능에 적합하다.</p>\n<p>인터셉터는 DispatcherServlet과 Controller 사이의 요청을 가로채며 세부적인 보안 및 인증/인가에 관련된 공통 작업과 Controller로 넘겨주는 데이터를 가공하는데 적합하다.</p>","excerpt":"필터와 인터셉터 모두 웹 애플리케이션에서 요청을 가로채어 중간에서 작업을 처리하는 구성요소이다. 공통점 필터 체인, 인터셉터 스택을 통해서 요청과 응답에 대한 여러 작업을 순차적으로 처리할 수 있다. 두 기능 모두 웹 애플리케이션의 핵심 로직과 분리되어 작업을 수행하고, 작업을 공통적으로 처리하여 코드의 중복을 줄일 수 있는 장점이 있다. 이 둘은 어떻게 동작하며, 차이점은 무엇이 있을까? 각 기능에 대해서 알아보자! Filter 필터는 J2EE 표준 스펙 기능으로 DispatcherServlet에 요청이 전달되기 전/후에 부가 작업을 처리할 수 있는 기능을 제공한다. 스프링이 아닌 톰캣과 같은 웹 컨테이너에 의해 관리가 되지만, 스프링 빈으로 등록은 가능하다.  메소드 Filter 인터페이스는 3가지 메소드를 가지고 있다. init 메소드 필터 객체를 초기화하고 서비스에 추가하기 위한 메소드 웹 컨테이너가 init 메소드를 호출하여 필터 객체를 초기화 하면 이후 요청들은 doFi…","frontmatter":{"date":"November 09, 2023","title":"Filter와 Interceptor","categories":"Spring","author":"화나","emoji":"🍃"},"fields":{"slug":"/spring/filter-interceptor/"}},"next":{"id":"fe646352-7627-5027-b614-3af64b7a2922","html":"<h2 id=\"인증과-인가\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9D%EA%B3%BC-%EC%9D%B8%EA%B0%80\" aria-label=\"인증과 인가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증과 인가</h2>\n<h3 id=\"인증authentication\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9Dauthentication\" aria-label=\"인증authentication permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증(Authentication)</h3>\n<p>사용자의 신원을 검증하는 행위, 보안 프로세스에서 첫 번째 단계</p>\n<h3 id=\"인가authorization-권한부여\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EA%B0%80authorization-%EA%B6%8C%ED%95%9C%EB%B6%80%EC%97%AC\" aria-label=\"인가authorization 권한부여 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인가(Authorization, 권한부여)</h3>\n<p>사용자에게 권한을 허용/거부하는 행위</p>\n<blockquote>\n<p>우리가 사용하는 HTTP의 특성</p>\n<ul>\n<li>비연결성 : 리소스 절약을 위해 서버는 하나의 요청에 대해서 응답을 주고 연결을 끊어버린다.</li>\n<li>무상태 : 서버는 클라이언트가 이전에 어떤 상태였는지 알지 못한다.</li>\n</ul>\n</blockquote>\n<p>🤔 그럼 연결이 되어있지 않고 상태도 안가지고 있는데 어떻게 인증과 인가를 진행하는걸까?</p>\n<h2 id=\"쿠키-세션-방식\" style=\"position:relative;\"><a href=\"#%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98-%EB%B0%A9%EC%8B%9D\" aria-label=\"쿠키 세션 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>쿠키-세션 방식</h2>\n<p>사용자의 인증 정보가 서버의 세션 저장소에 저장되는 방식이다.</p>\n<ol>\n<li>사용자가 로그인에 성공하면 서버는 사용자의 인증 정보를 세션 저장소에 저장하고, 사용자의 정보와는 관계없는 SESSION ID를 생성하여 클라이언트에게 응답값으로 전달한다.</li>\n<li>클라이언트는 SESSION ID를 쿠키에 저장하고 앞으로의 요청마다 SESSION ID를 함께 보낸다.</li>\n<li>서버는 요청값에 있는 SESSION ID에 해당하는 세션 정보가 세션 저장소에 있다면 사용자를 인증된 사용자로 판단한다.</li>\n</ol>\n<h3 id=\"문제점\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C%EC%A0%90\" aria-label=\"문제점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제점</h3>\n<p>쿠키-세션 방식은 다중 서버 환경에서 각 서버가 개별적으로 세션 저장소를 가지는 경우에 문제가 발생할 수 도 있다.</p>\n<p>매번 같은 서버로 요청이 전달되지 않고 각 세션저장소 별로 다른 인증정보를 가지고 있기 때문에 사용자 식별이 되지 않기 때문이다.</p>\n<h3 id=\"해결방법\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95\" aria-label=\"해결방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결방법</h3>\n<ol>\n<li>로드밸런서를 통해서 사용자를 식별하여 이전에 통신한 서버로 요청이 가도록 경로를 지정해주는 방법</li>\n<li>다중 서버의 모든 세션 저장소를 동일하게 유지하는 방법</li>\n</ol>\n<p>두번째 방식의 경우 다중 서버 환경임에도 불구하고 단일 저장소가 감당해야할 부하가 늘어난다.\r\n위와 같은 고민을 해결하려면 <strong>JWT(Json Web Token)</strong> 방식을 사용하면 된다.</p>\n<h2 id=\"jwt-기반-인증-방식\" style=\"position:relative;\"><a href=\"#jwt-%EA%B8%B0%EB%B0%98-%EC%9D%B8%EC%A6%9D-%EB%B0%A9%EC%8B%9D\" aria-label=\"jwt 기반 인증 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JWT 기반 인증 방식</h2>\n<p>인증에 필요한 정보들을 서버에 저장하지 않고 암호화 시킨 토큰으로 클라이언트가 직접 들고 있는 방식</p>\n<ol>\n<li>사용자가 로그인에 성공하면 서버는 인증 정보를 암호화해서 토큰 형식으로 응답값에 담아 전달한다.</li>\n<li>클라이언트는 토큰을 저장하고 있다가 요청값에 토큰을 담아서 보낸다.</li>\n<li>서버는 토큰을 발견하면 가지고 있는 비밀키로 토큰을 해독하여 사용자 검증을 한다.</li>\n</ol>\n<p>그렇다고 무조건 JWT 인증 방식이 좋은 것은 아니다. JWT로 인증을 하게 되면 구현의 복잡도가 증가하고 비밀키 유출 시 조작도 가능하게 된다. 그럼에도 JWT를 사용하는 이유는 서버의 부담이 줄어들기 때문이다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EC%9D%B8%EC%A6%9D%EA%B3%BC-%EC%9D%B8%EA%B0%80\">인증과 인가</a></p>\n<ul>\n<li><a href=\"#%EC%9D%B8%EC%A6%9Dauthentication\">인증(Authentication)</a></li>\n<li><a href=\"#%EC%9D%B8%EA%B0%80authorization-%EA%B6%8C%ED%95%9C%EB%B6%80%EC%97%AC\">인가(Authorization, 권한부여)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98-%EB%B0%A9%EC%8B%9D\">쿠키-세션 방식</a></p>\n<ul>\n<li><a href=\"#%EB%AC%B8%EC%A0%9C%EC%A0%90\">문제점</a></li>\n<li><a href=\"#%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95\">해결방법</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#jwt-%EA%B8%B0%EB%B0%98-%EC%9D%B8%EC%A6%9D-%EB%B0%A9%EC%8B%9D\">JWT 기반 인증 방식</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"November 08, 2023","title":"인증과 인가","categories":"보안","author":"화나","emoji":"🔐"},"fields":{"slug":"/security/authentication-authorization/"}},"prev":{"id":"5916bbd8-7edf-5e79-bc5e-16082ba80919","html":"<h1 id=\"websecurityconfig\" style=\"position:relative;\"><a href=\"#websecurityconfig\" aria-label=\"websecurityconfig permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WebSecurityConfig</h1>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\r\n<span class=\"token annotation punctuation\">@EnableWebSecurity</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WebSecurityConfig</span> <span class=\"token punctuation\">{</span>\r\n\r\n\t<span class=\"token annotation punctuation\">@Bean</span>\r\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">SecurityFilterChain</span> <span class=\"token function\">securityFilterChain</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token comment\">// CSRF 설정</span>\r\n\t\thttp<span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>csrf<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> csrf<span class=\"token punctuation\">.</span><span class=\"token function\">disable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n\t\thttp<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeHttpRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>authorize<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> authorize\r\n            <span class=\"token punctuation\">.</span><span class=\"token function\">requestMatchers</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PathRequest</span><span class=\"token punctuation\">.</span><span class=\"token function\">toStaticResources</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">atCommonLocations</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n                <span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n\t\thttp<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Customizer</span><span class=\"token punctuation\">.</span><span class=\"token function\">withDefaults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n\t\t<span class=\"token keyword\">return</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \r\n\t\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>CSRF(Cross Site Request Forgery)란?</p>\n<ul>\n<li>웹 취약점 공격 방법중 하나로 사용자가 자신의 의지와 무관하게 공격자가 의도한 행위를 특정 웹사이트에 요청하게 하는 공격</li>\n</ul>\n</li>\n<li>\n<p>Spring Security에서는 CSRF 예방기능을 제공하는데 DISABLE 하는 이유</p>\n<p><a href=\"https://docs.spring.io/spring-security/reference/features/exploits/csrf.html#csrf-considerations\">Cross Site Request Forgery (CSRF) :: Spring Security</a></p>\n<p>공식 페이지에 나와있듯, CSRF 설정은 브라우저에서 처리할 수 있는 모든 요청에 대해서 사용하는 것이 좋다. CSRF를 사용하지 않도록 사용하는 경우는 브라우저 이외의 클라이언트에서만 사용하는 서비스(REST API)를 생성할 경우이다. REST API는 서버에 인증정보를 보관하지 않기 때문에 CSRF 공격에 크게 영향을 받지 않는다.</p>\n</li>\n<li>\n<p>authorizeRequests() : 특정 경로에 대한 접근 권한을 지정하는 메소드</p>\n</li>\n<li>\n<p>requestMatchers(PathRequest.toStaticResources().atCommonLocations()).permitAll() : 정적 리소스에 대한 접근은 모두에게 허용한다.</p>\n</li>\n<li>\n<p>anyRequest().authenticated() : 나머지 모든 요청은 인증된 사용자에게 허용된다.</p>\n</li>\n<li>\n<p>http.build() : http 객체를 빌드하여 SecurityFilterChain빈을 반환한다.</p>\n</li>\n</ul>\n<h1 id=\"usernamepasswordauthenticationfilter\" style=\"position:relative;\"><a href=\"#usernamepasswordauthenticationfilter\" aria-label=\"usernamepasswordauthenticationfilter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UsernamePasswordAuthenticationFilter</h1>\n<ul>\n<li>스프링 시큐리티에서 제공하는 사용자 인증을 처리하는데 사용되는 필터</li>\n<li>사용자가 제공한 사용자 이름과 비밀번호를 기반으로 인증을 수행한다.</li>\n<li>주로 웹 기반의 폼 로그인에서 사용하는 필터이다.</li>\n</ul>\n<h2 id=\"동작의-흐름\" style=\"position:relative;\"><a href=\"#%EB%8F%99%EC%9E%91%EC%9D%98-%ED%9D%90%EB%A6%84\" aria-label=\"동작의 흐름 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>동작의 흐름</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 91.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFdklEQVQ4yzWQCVCTdxDFF0SkylER1HrgSFVQq0VBreJRO3aKM6IiEAJJOAzxywUKihwWVEC5Kh4cAWJIvhwcaaIIKCBKkTMEQgKBEAmikqoYrHe9nX8nVHfmN2/f7O7MzoMV7ivd1ixfvXrF0h88md7uO47vcN/lu3bV2uDQsKk0/53TA4gkS7t539sAgN3+UvV+YolKRChUcAPy2i4Si1UcIlddSBHe5kZKH7pFysYBgsIjp6JDKwHFOME75uIj75mLL79lLnVHR5fBql1kK//dvtZTXNdZubm6erD5XbeCzjciwrkGRDj7P4FnriJSUQfC5CYfrGoCIGq9izVKc3dA17ztHmFuK1uISzYhsZcjKvWw1zG8HLyIjCkz7B2nUVIlUHe5duYl9ev51Pg/tgfTEwlXNK/nc67qFufLuxd69CAQpnIARjIphD7Sd68a9jg9vunnPFG/x3mica/zoxt7nd8YqQsrUDbAdIBpGEdhFyQybvYTPvjJr0j7y28pMoJvQd/WAMnjDcGy59tC//xnJfXqvwCqgsSQ3oPe+hu09ap6qpeyNsJT0XRgg/IvbL1h9KBnNkC7JWcMAa9lbHNUxQCKEPQimliLqIJeFHFR8QUlYl5+WB5VbQQIuFBrvRv+r3uJPlv00d5khIbtIgEAAUAtnm9pnoWQaD/GpnGIMencAFbyhZDDWXzf/GrVpnOyjs250rZtqWVKl2yZEiDw1y02sQCTR5/YrrEf2K6Vg6RFngghIG10d/BYs8bGydHpG1trOxcAmPWF2QAw47iwHdLL2uGkqAWSREo4Ud4FwDyWabXDP+LbbTuJjrD1mB0so86CnUdsfPwp9ht8Am3tbWdYz12+zuoYQhY/U2Kmb/THbLdTk6Zv9wtdEnTotG1yF7JiC5TWLNmoFSGv1QL84grNz1kDwNx5AC6udrB69+kqCJcagSLQTUZB57ZCYHH31705AOCwaI7TFh5CQChsgxCJAcLlDyG4SAlAPXvNnVp5359R83RXSIkqIJQ/QKBW3NsTLhkJoIpv+8wGsKQVNm+giAwJZFx/kITrD4XwtDGB+Z2JJP5gbPDF/lhiiTomrOxe3L5TV/bB76K2TCpPifbzlJ+ovO7PVJ7yc3hJ56eI4nZE5Ws0EoTgZHlnBoarEIb3PqOLNC8xXPWSLu57gQl7zWr2z6ncjvdBWTVFkCxqp7El/V0sibaJJe5vZuC9zSzJQFNUpb6TVTnCfYUQpMq1h+MbX/7NEGt1mKBXj+EavVkPCFR6Gk+px3D1UELTm1Hy+aYsOCFuSWDg3fcZIvUAXdAzRBd0DzFE6kGGSH2XUaa7ZEII0mXqhKN1Tx6xxP23mUKNgYGrDQyh2sDAew10fo+BKdQMx19/PkY+25gNKXJd7JGGF3fCSzr7KAW3tOHFHVpyXlNfdNWDkcPXX0s1CEFalS45vvn9M6xs8B5NqDZGCjXGSH6PMVKgMmLlQ0amdHgsoeWjiVLYdh7S5ZozcfUTH0Lzrk+E5NY8JZ2peRqUIX0SJb/zLq7x5c2PCEGGXMVOvPpAdViquxVT1tcaU97fGluubY2ZpN+sLUl14wpyTm0S5GWmOXFOJrlU8PAFUoF4ErlEuqA0+/TC4wejnKvNGV4ZTmHJx96EXLj5KKxYYQotajeFlShMocWdJnJBs4lc2DrOqnr4IqxIUQA4pwCE53Kh9nI91FXfgGvVN6ChrhVkvFLInwlwahxBamV3XHTlkJFdptVFV+r1URW6SQ7JDHqzZ0v6h6Ir9aPBOdcyIY8vs8gRNlhk4/UWOV8w9xncKouUW28tU+8iSCtvP8kQqh5j/C4DVqoY/Qod7xml492jNG7bCF2oekDKrcv6D+wo3nj/znU1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/662295215e47b909a64ae292068f09b2/37523/1.png\"\n        srcset=\"/static/662295215e47b909a64ae292068f09b2/e9ff0/1.png 180w,\n/static/662295215e47b909a64ae292068f09b2/f21e7/1.png 360w,\n/static/662295215e47b909a64ae292068f09b2/37523/1.png 720w,\n/static/662295215e47b909a64ae292068f09b2/302a4/1.png 1080w,\n/static/662295215e47b909a64ae292068f09b2/07a9c/1.png 1440w,\n/static/662295215e47b909a64ae292068f09b2/2b608/1.png 1540w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ol>\n<li>사용자가 로그인 폼에 이름과 비밀번호를 입력한 뒤 로그인 요청을 전송하면 UsernamePasswordAuthenticationFilter 가 요청을 가로채서 사용자가 입력한 정보로 UsernamePasswordAuthenticationToken 을 생성한다.</li>\n<li>생성한 토큰을 AuthenticationManager 에게 전달한다. AuthenticationManager 는 실제로 사용자를 인증하는 역할을 수행한다.\n<ul>\n<li>인증에 성공할 경우\n<ul>\n<li>Authentication 객체를 생성하고 이 객체를 SecurityContextHolder에 저장한다.</li>\n<li>AuthenticationSuccessHandler 실행되어 로그인 이후 특정 동작을 수행한다.</li>\n</ul>\n</li>\n<li>인증에 실패할 경우\n<ul>\n<li>AuthenticationFailureHandler가 실행되어 에러페이지로 리디렉션하거나 특정 동작을 구행한다.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"securitycontextholder\" style=\"position:relative;\"><a href=\"#securitycontextholder\" aria-label=\"securitycontextholder permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SecurityContextHolder</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAACBUlEQVQozzWLzVMSYQCH97/rkpPJ1HTq0LRYl05+NFOHGg9M5ojLgpCKrisbIJSyLLi7fCyLieBCmqGpI2VjzsSkjV2AgPf9NTDT4bk88zyM493eq+GNJlitTVitTVm1hZtOEzZfBXfndzHgNHHHV8bQ7A5s3h3c4vIY5DZxw6Fi0PsRdr3Te8GqbTxOdcBMrVVEoXgN47RFtOMG1Y4bUCo/MBs1wYXS8EQycAY24JR0uMIZTAdUeKImIpvHkMsX0E+a6D3Z0yaWSn/AvH5f8ZvVS5xf/SW1eoPW6g2cXwOFz2dQzF1krCPEDQtaoYpU8RCyUYZePETtVxtnV13U6s0+3y9byFV/g3FH8otP/BU80ECGdUIfql1q1yllk01qc2/Tgek8tc1adNBdokOeMr3t2qL3lg77jV0jlNUIfZSi9L7SoZPqT8pMSWn/S6GA0PZ5R0hXu+HCVxLIHZHQ1jcysbpPFuLbxBMxyFxsi3gjGeIKZ8lE9ICIxhERs1+IlD8hYvaALKRPiE+/6DKTwZz4wpfGulrCclCBEExgxhvAavwDuOg+VqJpzC3HIAST8EtxvFlJwCEW4V+JYV5cg/BWwZIkw+2PgY/VwCyuGY5nHvnTyIxcGueT1iinWGN80hqZka1xbt0a4eLWGJ+wxlz/UaynvNxv+vQcn9gZ5TfKz6U94x/EbaUduIWe/AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/28f0f6e49649bc90a0d215b286da1559/37523/2.png\"\n        srcset=\"/static/28f0f6e49649bc90a0d215b286da1559/e9ff0/2.png 180w,\n/static/28f0f6e49649bc90a0d215b286da1559/f21e7/2.png 360w,\n/static/28f0f6e49649bc90a0d215b286da1559/37523/2.png 720w,\n/static/28f0f6e49649bc90a0d215b286da1559/587b0/2.png 970w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>\n<p>현재 사용자의 인증 정보를 저장하고 언제든지 접근할 수 있도록 하는 클래스이며 SecurityContext를 관리한다.</p>\n</li>\n<li>\n<p>SecurityContext에는 Authentication 객체와 관련된 보안 정보가 저장된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">SecurityContext</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token class-name\">Authentication</span> <span class=\"token function\">getAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token keyword\">void</span> <span class=\"token function\">setAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>Authentication는 현재 사용자의 인증정보를 나타내는 인터페이스이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Authentication</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Principal</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token class-name\">Object</span> <span class=\"token function\">getCredentials</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token class-name\">Object</span> <span class=\"token function\">getDetails</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token class-name\">Object</span> <span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token keyword\">boolean</span> <span class=\"token function\">isAuthenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token keyword\">void</span> <span class=\"token function\">setAuthenticated</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">boolean</span> isAuthenticated<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<h2 id=\"userdetailsservice\" style=\"position:relative;\"><a href=\"#userdetailsservice\" aria-label=\"userdetailsservice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UserDetailsService</h2>\n<p>사용자의 정보를 DB에서 가져와 검증하고 UserDetails 객체로 반환한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomUserDetailsService</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserDetailsService</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token annotation punctuation\">@Autowired</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserRepository</span> userRepository<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token annotation punctuation\">@Override</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserDetails</span> <span class=\"token function\">loadUserByUsername</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">UsernameNotFoundException</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByUsername</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span>\r\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UsernameNotFoundException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"User not found with username: \"</span> <span class=\"token operator\">+</span> username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CustomUserDetails</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"userdetails\" style=\"position:relative;\"><a href=\"#userdetails\" aria-label=\"userdetails permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UserDetails</h2>\n<p>사용자의 정보를 표현하는 인터페이스,  UsernamePasswordAuthenticationToken 타입의 Authentication를 만들 때 사용되며 해당 인증객체는 SecurityContextHolder에 세팅된다.</p>\n<h1 id=\"기본-로그인\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EB%B3%B8-%EB%A1%9C%EA%B7%B8%EC%9D%B8\" aria-label=\"기본 로그인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기본 로그인</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSklEQVQY012Qy0rDQBiF81Q+jA/hY7jvoqW5CBWsUMWF4s6VYLEo1mBMFRN00aY2t5p0Lv/8k5mOSBdWv92Bc+DjWGYLrTUA/Oa1kVwDlUCkBLVdK8slpdQKivkwiUtGUAgOnBDCOWeMAwClpFpVSivZIAgQQjRNY4xhlI5uR1EUW0eTu5P74eV4FIwffd/P8zzLsvHDOMsyAEg+05pQxvgknDDOKaUAMJvNBoPTIHi2XhbJTRgwFPVXRQhZrVaIKARKZErJjb3WWjXIOUdEYwwHiKK4KApLKbWR2ZBlaZqmZbkkdY7I96/ivYu369fEGJmXpe/7YRgmyZyzHwvr32ECoKrr6XQmBMhG756/7ww+zp4WxphGaSklAGit18Yg4p+xUqrf77darXa7bdu24zjHPW9w6PUOvG7Xtm3bdV3P8xzHcV230+l8A4HYeMdBL7zqAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3\"\n        title=\"3\"\n        src=\"/static/c296bd303b5bc5bb85f1e40013bae820/37523/3.png\"\n        srcset=\"/static/c296bd303b5bc5bb85f1e40013bae820/e9ff0/3.png 180w,\n/static/c296bd303b5bc5bb85f1e40013bae820/f21e7/3.png 360w,\n/static/c296bd303b5bc5bb85f1e40013bae820/37523/3.png 720w,\n/static/c296bd303b5bc5bb85f1e40013bae820/302a4/3.png 1080w,\n/static/c296bd303b5bc5bb85f1e40013bae820/07a9c/3.png 1440w,\n/static/c296bd303b5bc5bb85f1e40013bae820/29114/3.png 1920w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ol>\n<li>로그인 시도할 username, password 정보를 POST HTTP body로 전달한다. Authentication Manager는 UserDetailsService에게 username을 전달하고 회원 상세정보를 요청한다.</li>\n<li>UserDetailsService는 전달받은 username으로 DB에서 회원 정보를 조회한다.\n<ul>\n<li>성공할 경우 UserDetails 객체를 생성하여 반환한다.</li>\n<li>실패할 경우 에러를 발생시킨다.</li>\n</ul>\n</li>\n<li>Authentication Manager는 전달받은 UserDetails 객체로 인증을 시도하여 성공하면 세션에 로그인 정보를 저장한다.</li>\n</ol>\n<blockquote>\n<p>UserDetailsService와 UserDetails를 직접 구현하면 Spring Security에서 제공하는 디폴트 로그인 기능을 사용하지 않겠다는 뜻이 되어서 기본 비밀번호를 제공하지 않는다.</p>\n</blockquote>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EB%8F%99%EC%9E%91%EC%9D%98-%ED%9D%90%EB%A6%84\">동작의 흐름</a></p>\n<ul>\n<li><a href=\"#securitycontextholder\">SecurityContextHolder</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#userdetailsservice\">UserDetailsService</a></p>\n</li>\n<li>\n<p><a href=\"#userdetails\">UserDetails</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"November 10, 2023","title":"Spring Security","categories":"보안","author":"화나","emoji":"🔐"},"fields":{"slug":"/security/spring-security/"}},"site":{"siteMetadata":{"siteUrl":"https://www.hwana.com","comments":{"utterances":{"repo":"hwana/hwana.github.io"}}}}},"pageContext":{"slug":"/spring/filter-interceptor/","nextSlug":"/security/authentication-authorization/","prevSlug":"/security/spring-security/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}